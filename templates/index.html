<!DOCTYPE html>
<html>
<head>
    <style>
        body{
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #101720;
            background-image: url("background.png");
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: center;
            background-blend-mode: overlay;
            background-transparency: 0.5;
        }
        .grid-container {
            display: grid;
            grid-template-columns: auto auto auto;
            gap: 0px;
            padding: 0px;
          }
          
        .grid-container > div {
            text-align: center;
            padding: 5px 0;
            font-size: 30px;
        }
        
        .item1 {
            grid-column-start: 1;
            grid-column-end: 4;
        }
        .item2 {
            grid-column-start: 1;
            grid-column-end: 1;
        }
        .item3 {
            grid-column-start: 2;
            grid-column-end: 4;
        }
        .item4 {
            grid-column-start: 1;
            grid-column-end: 4;
        }
        .item5 {
            grid-column-start: 1;
            grid-column-end: 1;
        }
        
        #joystick {
            border: 1px solid black;
            border-radius: 50%;
            width: 200px;
            height: 200px;
            position: relative;
            margin: 0 auto;
            align-items: center;
            background: radial-gradient(circle at 50% 50%, #ffffff, #e5e5e5, #cbcbcb, #b2b2b2, #9a9a9a, #828282, #6c6c6c, #565656, #404040, #2c2c2c, #1a1a1a, #000000);
        }
        #knob {
            border: 2px solid black;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            position: absolute;
            top: 75px;
            left: 75px;
            cursor: pointer;
            background: radial-gradient(circle at 50% 50%, #484848, #4b4b4b, #4f4f4f, #525252, #555555, #595959, #5c5c5c, #606060, #636363, #676767, #6a6a6a, #6e6e6e);}
        
        
        .btnGreen {
            background: #1efc0a;
            background-image: -webkit-linear-gradient(top, #1efc0a, #3e702d);
            background-image: -moz-linear-gradient(top, #1efc0a, #3e702d);
            background-image: -ms-linear-gradient(top, #1efc0a, #3e702d);
            background-image: -o-linear-gradient(top, #1efc0a, #3e702d);
            background-image: linear-gradient(to bottom, #1efc0a, #3e702d);
            -webkit-border-radius: 28;
            -moz-border-radius: 28;
            border-radius: 28px;
            font-family: Arial;
            color: #ffffff;
            font-size: 26px;
            padding: 10px 20px 10px 20px;
            text-decoration: none;
        }
        
        .btnGreen:hover {
        background: #59fa41;
        background-image: -webkit-linear-gradient(top, #59fa41, #41c221);
        background-image: -moz-linear-gradient(top, #59fa41, #41c221);
        background-image: -ms-linear-gradient(top, #59fa41, #41c221);
        background-image: -o-linear-gradient(top, #59fa41, #41c221);
        background-image: linear-gradient(to bottom, #59fa41, #41c221);
        text-decoration: none;
        }
        
        .btnRed {
        background: #f02222;
        background-image: -webkit-linear-gradient(top, #f02222, #9e2929);
        background-image: -moz-linear-gradient(top, #f02222, #9e2929);
        background-image: -ms-linear-gradient(top, #f02222, #9e2929);
        background-image: -o-linear-gradient(top, #f02222, #9e2929);
        background-image: linear-gradient(to bottom, #f02222, #9e2929);
        -webkit-border-radius: 28;
        -moz-border-radius: 28;
        border-radius: 28px;
        font-family: Arial;
        color: #ffffff;
        font-size: 26px;
        padding: 10px 20px 10px 20px;
        text-decoration: none;
        }
        
        .btnRed:hover {
        background: #fa3f3f;
        background-image: -webkit-linear-gradient(top, #fa3f3f, #c42035);
        background-image: -moz-linear-gradient(top, #fa3f3f, #c42035);
        background-image: -ms-linear-gradient(top, #fa3f3f, #c42035);
        background-image: -o-linear-gradient(top, #fa3f3f, #c42035);
        background-image: linear-gradient(to bottom, #fa3f3f, #c42035);
        text-decoration: none;
        }
        
        .fullSpeed{
            font-size: 20px;
        }
        
        .slidecontainer {
        width: 100%; /* Width of the outside container */
        }
        
        .slider {
        -webkit-appearance: none;  
        appearance: none;
        width: 50%; 
        height: 5px; 
        background: #d3d3d3; 
        outline: none; 
        opacity: 0.7; 
        -webkit-transition: .2s; 
        transition: opacity .2s;
        }
        
        
        
        
        .infoTXT{
            font-family: Arial, Helvetica, sans-serif;
            font-size: 25px;
            letter-spacing: -0.6px;
            word-spacing: 0.4px;
            color: #ccff33;
            font-weight: 700;
            text-decoration: none solid rgb(68, 68, 68);
            font-style: normal;
            font-variant: normal;
            text-transform: none;
        }
        
        .infoValues{
            font-family: Arial, Helvetica, sans-serif;
            font-size: 30px;
            letter-spacing: -0.6px;
            word-spacing: 0.4px;
            color: #FFFFFF;
            font-weight: 700;
            text-decoration: none solid rgb(68, 68, 68);
            font-style: normal;
            font-variant: normal;
            text-transform: none;
        }
        
        
          
    </style>
    <title>Motor Control</title>
</head>
<body>
    <div class="grid-container">
      <div class="item1">
        <!-- Image as logo and Title -->
        <img src="cprob_logo.png" alt="Logo" height="100px">
      </div>
      <div class="item2">
       
       <div class="grid-container">
         <div class="item1">
            <div class="Center buttons">
                <button class="btnGreen" onclick="lightON()">Light ON</button>
                <button class="btnRed" onclick="lightOFF()">Light OFF</button>
                <button class="btnRed" onclick="emergencySTOP()">Emergency Stop</button>
            </div>
         </div>
         <div class="item1">
            <a class="infoTXT">Vertical Control</a>
            <div id="joystick">
                <div id="knob"></div>
            </div>
         </div>
         <div class="item1">
            <br><br>
            <a class="infoTXT">Speed Control</a>
            <div class="slidecontainer">
                <input type="range" min="1" max="100" value="50" class="slider" id="myRange">
            </div>
            <a class="infoTXT"> <<< &emsp;&emsp; >>> </a><br><br>
            <div>
                <button class="btnGreen fullSpeed" onclick="goBackward()">Full Speed Back</button>
                <button class="btnRed" onclick="stop()">STOP</button>
                <button class="btnGreen fullSpeed" onclick="goForward()">Full Speed Front</button>
            </div>
         </div>
       </div>
      </div>
      <div class="item3">
        <div >
            <a class="infoTXT">Camera Stream</a>
        </div>
        <div class="VideoStream">
            <iframe width="640" height="480" src="http://192.168.200.202:5000/video_feed"></iframe>
        </div>
        <div >
            <a id="Time" class="infoTXT"><span>0</span></a>
        </div>
     </div> 
        <div >
            <a class="infoTXT">PH Value</a><br>
            <a id="PHSensor" class="infoValues"><span>0</span></a>
        </div> 
        <div >
            <a class="infoTXT">Cond. Value</a><br>
            <a id="CondSensor" class="infoValues"><span>0</span></a>
        </div> 
        <div >
            <a class="infoTXT">Ext Temp</a><br>
            <a id="TmpSensor" class="infoValues"><span>0</span></a>
        </div> 
        <div >
            <a class="infoTXT">Bat Level</a><br>
            <a id="BatSensor" class="infoValues"><span>0</span></a>
        </div> 
        <div >
            <a class="infoTXT">Sonar Det.</a><br>
            <a id="SonarSensor" class="infoValues"><span>0</span></a>
        </div> 
        <div >
            <a class="infoTXT">Gyro Info</a><br>
            <a id="GiroSensor" class="infoValues"><span>0</span></a>
        </div> 
    </div>


<script>

    const joystick = document.getElementById('joystick');
    const knob = document.getElementById('knob');
    const speedControl = 100;
    let BatteryLevel = 100;
    let isDragging = false;

    // Update sensor values every second
    setInterval(updateSensorValues, 1000);

    joystick.addEventListener('mousedown', function(e) {
        isDragging = true;
    });

    document.addEventListener('mouseup', function(e) {
        isDragging = false;
    });

    document.addEventListener('mousemove', function(e) {
        if (isDragging) {
            const rect = joystick.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            const deltaX = e.clientX - centerX;
            const deltaY = e.clientY - centerY;
            const distance = Math.min(75, Math.sqrt(deltaX * deltaX + deltaY * deltaY));
            const angle = Math.atan2(deltaY, deltaX);

            const knobX = 75 + distance * Math.cos(angle);
            const knobY = 75 + distance * Math.sin(angle);
            knob.style.left = `${knobX}px`;
            knob.style.top = `${knobY}px`;

            const speedMultiplier = 1;

            let motorASpeed = distance * speedMultiplier;
            let motorBSpeed = distance * speedMultiplier;

            if (deltaY < 0) {  // Forward
                motorASpeed = motorASpeed;
                motorBSpeed = motorBSpeed;
            } else {  // Backward
                motorASpeed = -motorASpeed;
                motorBSpeed = -motorBSpeed;
            }

            if (deltaX > 0) {  // Right
                motorASpeed = motorASpeed * (1 - Math.abs(deltaX / 75));
                motorBSpeed = motorBSpeed * (1 + Math.abs(deltaX / 75));
            } else {  // Left
                motorASpeed = motorASpeed * (1 + Math.abs(deltaX / 75));
                motorBSpeed = motorBSpeed * (1 - Math.abs(deltaX / 75));
            }
            console.log(motorASpeed, motorBSpeed);
            controlMotors(motorASpeed, motorBSpeed);
        }
    });


    function goForward(){
        fetch('/forward', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `forward=1`
        });
    }

    function goBackward(){
        fetch('/backward', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `backward=1`
        });
    }

    function stop(){
        fetch('/stop', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `stop=1`
        });
    }

    function emergencySTOP(){
        fetch('/emergency', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `emergency=1`
        });
    }

    function lightON(){
        fetch('/light', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `status=1`
        });
    }

    function lightOFF(){
        fetch('/light', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `status=0`
        });
    }

    function controlMotors(motorA, motorB) {
        fetch('/control', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `motorA=${motorA}&motorB=${motorB}`
        });
    }

    var slider = document.getElementById("myRange");
    var output = document.getElementById("demo");
    output.innerHTML = slider.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    slider.oninput = function() {
    output.innerHTML = this.value;
    }

    function updateSensorValues() {
        
        BatteryLevel = BatteryLevel-0.001;

        const minGyroValue = -180; // Assuming -180 degrees per second
        const maxGyroValue = 180; // Assuming +180 degrees per second

        const randomXGyroValue = Math.random() * (maxGyroValue - minGyroValue) + minGyroValue;
        const randomYGyroValue = Math.random() * (maxGyroValue - minGyroValue) + minGyroValue;
        const randomZGyroValue = Math.random() * (maxGyroValue - minGyroValue) + minGyroValue;
    
        document.getElementById('PHSensor').querySelector('span').innerText = (Math.random() * (8.4 - 7.5) + 7.5).toFixed(2) + " pH";
        document.getElementById('CondSensor').querySelector('span').innerText = (Math.random() * (53000 - 57000) + 53000).toFixed(2) + " µS/cm";
        document.getElementById('TmpSensor').querySelector('span').innerText = (Math.random() * (25 - 10) + 10).toFixed(2) + " °C";
        document.getElementById('BatSensor').querySelector('span').innerText = BatteryLevel.toFixed(2) + " %";
        document.getElementById('SonarSensor').querySelector('span').innerText = "FALSE";
        document.getElementById('GiroSensor').querySelector('span').innerText = randomXGyroValue.toFixed(3) + "°/s, " + randomYGyroValue.toFixed(3) + "°/s, " + randomZGyroValue.toFixed(3) + "°/s";
        document.getElementById('Time').querySelector('span').innerText = new Date();
    }

</script> 
</body>
</html>
